module Helpers
  
  # generic stuff
  def filter_nil!(hash)
    hash.each_pair {|key, value| hash.delete key if value.nil?}
  end
  
  def partial(template, options={})
    erb template, options.merge(:layout => false)
  end
  
  def navigation_tab(text, path, options={}, link_options={})
    tag :li, link_to(text, path, link_options), filter_nil!({:class => request.path == path ? "selected" : nil})
  end
  
  # static realm list generated by get_realms()
  def get_realms_static
    {:us=>[{:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Aegwynn"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Aerie Peak"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Agamaggan"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Aggramar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Akama"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Alexstrasza"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Alleria"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Altar of Storms"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Alterac Mountains"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"Oceanic", :name=>"Aman'Thul"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Andorhal"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Anetheron"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Antonidas"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Anub'arak"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Anvilmar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Arathor"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Archimonde"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Area 52"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Argent Dawn"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Arthas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Arygos"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Auchindoun"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Azgalor"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Azjol-Nerub"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Azshara"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Azuremyst"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Baelgun"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Balnazzar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Oceanic", :name=>"Barthilas"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Black Dragonflight"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Blackhand"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Blackrock"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Blackwater Raiders"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Blackwing Lair"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Blade's Edge"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Bladefist"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Bleeding Hollow"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Blood Furnace"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Bloodhoof"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Bloodscalp"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Bonechewer"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Borean Tundra"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Boulderfist"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Bronzebeard"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Burning Blade"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Burning Legion"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"Oceanic", :name=>"Caelestrasz"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Cairne"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Cenarion Circle"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Cenarius"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Cho'gall"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Chromaggus"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Coilfang"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Crushridge"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Daggerspine"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Dalaran"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Dalvengyr"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Dark Iron"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Darkspear"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Darrowmere"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"Oceanic", :name=>"Dath'Remar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Dawnbringer"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Deathwing"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Demon Soul"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Dentarg"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Destromath"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Dethecus"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Detheroc"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Doomhammer"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Draenor"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Dragonblight"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Dragonmaw"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Drak'Tharon"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Drak'thul"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Draka"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Latin America", :name=>"Drakkari"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Oceanic", :name=>"Dreadmaul"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Drenden"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Dunemaul"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Durotan"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Duskwood"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Earthen Ring"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Echo Isles"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Eitrigg"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Eldre'Thalas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Elune"}, {:population=>"high", :type=>"rppvp", :status=>"up", :locale=>"United States", :name=>"Emerald Dream"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Eonar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Eredar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Executus"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Exodar"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Farstriders"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Feathermoon"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Fenris"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Firetree"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Fizzcrank"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Frostmane"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Oceanic", :name=>"Frostmourne"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Frostwolf"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Galakrond"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Garithos"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Garona"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Garrosh"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Ghostlands"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Gilneas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Gnomeregan"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Gorefiend"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Gorgonnash"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Greymane"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Grizzly Hills"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Gul'dan"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Oceanic", :name=>"Gundrak"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Gurubashi"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Hakkar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Haomarush"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Hellscream"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Hydraxis"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Hyjal"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Icecrown"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Illidan"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Jaedenar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Oceanic", :name=>"Jubei'Thos"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Kael'thas"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Kalecgos"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Kargath"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Kel'Thuzad"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Khadgar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Khaz Modan"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"Oceanic", :name=>"Khaz'goroth"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Kil'jaeden"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Kilrogg"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Kirin Tor"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Korgath"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Korialstrasz"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Kul Tiras"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Laughing Skull"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Lethon"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Lightbringer"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Lightning's Blade"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"United States", :name=>"Lightninghoof"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Llane"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Lothar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Madoran"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"United States", :name=>"Maelstrom"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Magtheridon"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Maiev"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Mal'Ganis"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Malfurion"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Malorne"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Malygos"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Mannoroth"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Medivh"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Misha"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Mok'Nathal"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Moon Guard"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Moonrunner"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Mug'thol"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Muradin"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"Oceanic", :name=>"Nagrand"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Nathrezim"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Nazgrel"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Nazjatar"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Ner'zhul"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Nesingwary"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Nordrassil"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Norgannon"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Onyxia"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Perenolde"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Proudmoore"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"Latin America", :name=>"Quel'Thalas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Quel'dorei"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"Latin America", :name=>"Ragnaros"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Ravencrest"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"United States", :name=>"Ravenholdt"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Rexxar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Rivendare"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Runetotem"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Sargeras"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"Oceanic", :name=>"Saurfang"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Scarlet Crusade"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Scilla"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Sen'jin"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Sentinels"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Shadow Council"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Shadowmoon"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Shadowsong"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Shandris"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Shattered Halls"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Shattered Hand"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Shu'halo"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Silver Hand"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Silvermoon"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Sisters of Elune"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Skullcrusher"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Skywall"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Smolderthorn"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Spinebreaker"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Spirestone"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Staghelm"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Steamwheedle Cartel"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Stonemaul"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Stormrage"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Stormreaver"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Stormscale"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Suramar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Tanaris"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Terenas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Terokkar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"Oceanic", :name=>"Thaurissan"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"The Forgotten Coast"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"The Scryers"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"The Underbog"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"United States", :name=>"The Venture Co"}, {:population=>"low", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Thorium Brotherhood"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Thrall"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Thunderhorn"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Thunderlord"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Tichondrius"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Tortheldrin"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Trollbane"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Turalyon"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"United States", :name=>"Twisting Nether"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Uldaman"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Uldum"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Undermine"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Ursin"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Uther"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Vashj"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Vek'nilash"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Velen"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Warsong"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Whisperwind"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Wildhammer"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Windrunner"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Winterhoof"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"United States", :name=>"Wyrmrest Accord"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Ysera"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Ysondre"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Zangarmarsh"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"United States", :name=>"Zul'jin"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"United States", :name=>"Zuluhed"}], :eu=>[{:population=>"high", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Aegwynn"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Aerie Peak"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Agamaggan"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Aggramar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Ahn'Qiraj"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Al'Akir"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Alexstrasza"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Alleria"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Alonsus"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Aman'Thul"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Ambossar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Anachronos"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Anetheron"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Antonidas"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Anub'arak"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Arak-arahm"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Arathi"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Arathor"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Archimonde"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Area 52"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"English", :name=>"Argent Dawn"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Arthas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Arygos"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Aszune"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Auchindoun"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Azjol-Nerub"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Azshara"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Azuremyst"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Baelgun"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Balnazzar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Blackhand"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Blackmoore"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Blackrock"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Blade's Edge"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Bladefist"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Bloodfeather"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Bloodhoof"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Bloodscalp"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Blutkessel"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Boulderfist"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Bronze Dragonflight"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Bronzebeard"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Burning Blade"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Burning Legion"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Burning Steppes"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"Spanish", :name=>"C'Thun"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Chamber of Aspects"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Chants \303\203\302\251ternels"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Cho'gall"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Chromaggus"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"Spanish", :name=>"Colinas Pardas"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"French", :name=>"Confr\303\203\302\251rie du Thorium"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"French", :name=>"Conseil des Ombres"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Crushridge"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"French", :name=>"Culte de la Rive noire"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Daggerspine"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Dalaran"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Dalvengyr"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"English", :name=>"Darkmoon Faire"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Darksorrow"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Darkspear"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"German", :name=>"Das Konsortium"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"German", :name=>"Das Syndikat"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Deathwing"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"English", :name=>"Defias Brotherhood"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Dentarg"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Der Mithrilorden"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Der Rat von Dalaran"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"German", :name=>"Der abyssische Rat"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Destromath"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Dethecus"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Die Aldor"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"German", :name=>"Die Arguswacht"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Die Nachtwache"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Die Silberne Hand"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"German", :name=>"Die Todeskrallen"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Die ewige Wacht"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Doomhammer"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Draenor"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Dragonblight"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Dragonmaw"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Drak'thul"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Drek'Thar"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"Spanish", :name=>"Dun Modr"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Dun Morogh"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Dunemaul"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Durotan"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"English", :name=>"Earthen Ring"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Echsenkessel"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Eitrigg"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Eldre'Thalas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Elune"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Emerald Dream"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Emeriss"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Eonar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Eredar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Executus"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"Spanish", :name=>"Exodar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Festung der St\303\203\302\274rme"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Forscherliga"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Frostmane"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Frostmourne"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Frostwhisper"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Frostwolf"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Garona"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Garrosh"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Genjuros"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Ghostlands"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Gilneas"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Gorgonnash"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Grim Batol"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Gul'dan"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Hakkar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Haomarush"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Hellfire"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Hellscream"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Hyjal"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Illidan"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Jaedenar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Kael'thas"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Karazhan"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Kargath"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Kazzak"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Kel'Thuzad"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Khadgar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Khaz Modan"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Khaz'goroth"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Kil'jaeden"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Kilrogg"}, {:population=>"high", :type=>"rp", :status=>"up", :locale=>"French", :name=>"Kirin Tor"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Kor'gall"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Krag'jin"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Krasus"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Kul Tiras"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"German", :name=>"Kult der Verdammten"}, {:population=>"medium", :type=>"rppvp", :status=>"up", :locale=>"French", :name=>"La Croisade \303\203\302\251carlate"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Laughing Skull"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"French", :name=>"Les Clairvoyants"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"French", :name=>"Les Sentinelles"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Lightbringer"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Lightning's Blade"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Lordaeron"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"Spanish", :name=>"Los Errantes"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Lothar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Madmortem"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Magtheridon"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Mal'Ganis"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Malfurion"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Malorne"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Malygos"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Mannoroth"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Mar\303\203\302\251cage de Zangar"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Mazrigos"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Medivh"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"Spanish", :name=>"Minahonda"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"English", :name=>"Moonglade"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Mug'thol"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Nagrand"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Nathrezim"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Naxxramas"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Nazjatar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Nefarian"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Neptulon"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Ner'zhul"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Nera'thor"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Nethersturm"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Nordrassil"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Norgannon"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Nozdormu"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Onyxia"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Outland"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Perenolde"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Proudmoore"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Quel'Thalas"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Ragnaros"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Rajaxx"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Rashgarroth"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Ravencrest"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"English", :name=>"Ravenholdt"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Rexxar"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Runetotem"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"Spanish", :name=>"Sanguino"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Sargeras"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Saurfang"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"English", :name=>"Scarshield Legion"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Sen'jin"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Shadowsong"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Shattered Halls"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Shattered Hand"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Shattrath"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"Spanish", :name=>"Shen'dralar"}, {:population=>"high", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Silvermoon"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Sinstralis"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Skullcrusher"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Spinebreaker"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"English", :name=>"Sporeggar"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"English", :name=>"Steamwheedle Cartel"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Stormrage"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Stormreaver"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Stormscale"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Sunstrider"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Suramar"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Sylvanas"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Taerar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Talnivarr"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Tarren Mill"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Teldrassil"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Temple noir"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Terenas"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Terokkar"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Terrordar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"The Maelstrom"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"English", :name=>"The Sha'tar"}, {:population=>"low", :type=>"rppvp", :status=>"up", :locale=>"English", :name=>"The Venture Co"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Theradras"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Thrall"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Throk'Feroth"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Thunderhorn"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Tichondrius"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Tirion"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Todeswache"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Trollbane"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Turalyon"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Twilight's Hammer"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Twisting Nether"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"Spanish", :name=>"Tyrande"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Uldaman"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Ulduar"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"Spanish", :name=>"Uldum"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Un'Goro"}, {:population=>"low", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Varimathras"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Vashj"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Vek'lor"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Vek'nilash"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"French", :name=>"Vol'jin"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"English", :name=>"Wildhammer"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Wrathbringer"}, {:population=>"low", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Xavius"}, {:population=>"medium", :type=>"pve", :status=>"up", :locale=>"German", :name=>"Ysera"}, {:population=>"high", :type=>"pvp", :status=>"up", :locale=>"French", :name=>"Ysondre"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"English", :name=>"Zenedar"}, {:population=>"medium", :type=>"rp", :status=>"up", :locale=>"German", :name=>"Zirkel des Cenarius"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"Spanish", :name=>"Zul'jin"}, {:population=>"medium", :type=>"pvp", :status=>"up", :locale=>"German", :name=>"Zuluhed"}]}
  end

  # Get the realm list from the battle.net site
  def get_realms
    realms = {}
    # TODO: implement caching here
    
    source_urls = [
      {:label => "us", :url => "http://us.battle.net/wow/en/status"}, 
      {:label => "eu", :url => "http://eu.battle.net/wow/en/status"}]
    
    source_urls.each do |source_url|
      realms[source_url[:label].to_sym] = []
      
      source = Nokogiri::HTML(open(source_url[:url]))
      realm_list = source.css("div#all-realms table tr")
      realm_list.each do |realm|
        realms[source_url[:label].to_sym].push({
          :name => realm.css("td.name").inner_text.strip,
          :status => realm.at_css("td.status").attribute("data-raw").to_s,
          :type => realm.at_css("td.type").attribute("data-raw").to_s,
          :population => realm.at_css("td.population").attribute("data-raw").to_s,
          :locale => realm.css("td.locale").inner_text.strip
        }) unless realm.css("td.name").empty?
      end
      realms[source_url[:label].to_sym] = realms[source_url[:label].to_sym].sort_by {|realm| realm[:name] }
    end

    realms
  end
  
  # display the realm list select
  def realmlist
    realms = get_realms_static
    partial :_realmlist, :locals => {:realms => realms}
  end
  
  # Find an item's recipe by ID on wowhead.com
  def recipe_by_id(item_id)
    # TODO: implement caching
    
    id_search = Nokogiri::XML(open("http://www.wowhead.com/item=#{item_id}&xml"))

    if id_search.css('wowhead error').length == 1
      {:error => "not found"}
    else
      if id_search.css('wowhead item createdBy').length == 1
        total_cost = 0
        reagents = []
        reagents_xml = id_search.css('wowhead item createdBy spell reagent')
        reagents_xml.each do |reagent|
          
          # determine if this reagent can be bought from a vendor (source: 5)
          # TODO: this needs to ignore items sold by vendors for something other than cash!
          # reagent_json["source"].include?(5) ? vendor_price(reagent.attribute('id')) : item_value(reagent.attribute('id'))[:precise]
          reagent_search = Nokogiri::XML(open("http://www.wowhead.com/item=#{reagent.attribute('id')}&xml"))
          reagent_json = JSON "{#{reagent_search.css('wowhead item json').inner_text.strip}}"
          item_cost = item_value(reagent.attribute('id'))[:precise]
          total_cost += item_cost * reagent.attribute('quality').content.to_i
          
          reagents.push({
            :item_id => reagent.attribute('id').to_s,
            :name => reagent.attribute('name').to_s,
            :icon => reagent.attribute('icon').to_s,
            :quality => reagent.attribute('quality').content.to_i,
            :quantity => reagent.attribute('count').content.to_i,
            :price => item_cost
          })
        end
        recipe = {
          :item_id => item_id,
          :name => id_search.css('wowhead item name').inner_text.strip.to_s,
          :icon => id_search.css('wowhead item icon').inner_text.strip.to_s,
          :level => id_search.css('wowhead item level').inner_text.strip,
          :quality => id_search.css('wowhead item quality').attribute('id').content.to_i,
          :reagents => reagents,
          :price => total_cost
        }
        recipe
      else
        # this item can't be crafted
        recipe = {
          :item_id => item_id,
          :name => id_search.css('wowhead item name').inner_text.strip.to_s,
          :icon => id_search.css('wowhead item icon').inner_text.strip.to_s,
          :level => id_search.css('wowhead item level').inner_text.strip,
          :quality => id_search.css('wowhead item quality').attribute('id').content.to_i,
          :reagents => [],
          :price => 0,
          :notcrafted => true
        }
      end
    end
  end
  
  # Find an item's ID by name on wowhead.com
  def item_id_from_name(name)
    # TODO: implementation
    nil
  end
  
  # Determine an item's name from its ID on wowhead.com
  def item_name_from_id(item_id)
    # TODO: implement caching
    id_search = Nokogiri::XML(open("http://www.wowhead.com/item=#{item_id}&xml"))
    if id_search.css('wowhead error').length == 1
      nil
    else
      id_search.css('wowhead item name').inner_text.strip
    end
  end
  
  # Output an item's recipe markup
  def recipe(recipe)
    partial :_recipe, :locals => {:recipe => recipe}
  end
  
  # Output an item's icon
  # TODO: needs to more absolutely determine the location of all these icons (and maybe just cache them all locally anyway?)
  def item_icon(item)
    open_tag :img, :src => "http://eu.battle.net/wow-assets/static/images/icons/56/#{item[:icon].downcase}.jpg", :class => "icon"
  end
  
  # Determine an item's value using wowecon, returning it as a currency value
  def item_value(item_id, options={:region => "EU", :realm => "Alonsus", :faction => "A"})
    # TODO: implement caching
    # TODO: bypass wowecon for items sold by vendors
    # TODO: use vendor price for items not available on the market
    
    # example wowecon request:
    # http://data.wowecon.com/?type=price&item_name=Inferno%20Ink&server_name=Alonsus&region=EU&faction=A

    item_name = URI.escape(item_name_from_id(item_id), Regexp.new("[^#{URI::PATTERN::UNRESERVED}]"))
    options.each do |k,v| 
      options[k] = URI.escape(v, Regexp.new("[^#{URI::PATTERN::UNRESERVED}]"))
    end
    request_url = "http://data.wowecon.com/?type=price&item_name=#{item_name}&server_name=#{options[:realm]}&region=#{options[:region]}&faction=#{options[:faction]}"
    wowecon_source = Nokogiri::HTML(open(request_url))
    
    # a typical returned value looks like this:
    # <table class="wowecon_wowcurrency">
    #   <tr>
    #     <td class="wowcurrency_coin">183</td>
    #     <td class="wowcurrency_coin"><img alt="g" src=""/></td>
    #     <td class="wowcurrency_value">52</td>
    #     <td class="wowcurrency_coin"><img alt="s" src=""/></td>
    #     <td class="wowcurrency_value">63</td>
    #     <td class="wowcurrency_coin"><img alt="c" src=""/></td>
    #   </tr>
    # </table>
    
    tds = wowecon_source.css('table.wowecon_wowcurrency tr td')
    
    currency_types = {:g => :gold, :s => :silver, :c => :copper}
    currency_type = nil
    currency = {:gold => 0, :silver => 0, :copper => 0}
    
    tds.reverse_each do |td|
      if img = td.at_css('img')
        coin = img.attribute('alt').content.match(/([gsc])/)
        currency_type = currency_types[coin[0].to_sym]
        next
      end
      
      value = td.inner_text.strip.match(/([0-9]+)/)
      if value
        currency[currency_type] = value[0].to_i
      end
    end
    
    {:currency => currency, :precise => currency_to_float(currency)}
  end
  
  # determine the vendor price of an item, or 0 if not sold by a vendor
  def vendor_price(item_id)
    # TODO: implementation!
    #
    # Checking the (non-XML) source for an item page should find the following JSON structure, indicating a vendor price
    # {
    #   template: 'npc', 
    #   id: 'sold-by', 
    #   name: LANG.tab_soldby, 
    #   tabs: tabsRelated, 
    #   parent: 'lkljbjkb574', 
    #   hiddenCols: ['level', 'type'], 
    #   extraCols: [Listview.extraCols.stock, Listview.funcBox.createSimpleCol('stack', 'stack', '10%', 'stack'), Listview.extraCols.cost], 
    #   data: [
    #     {
    #       "classification":0,
    #       "id":49703,
    #       "location":[4922],
    #       "maxlevel":84,
    #       "minlevel":84,
    #       "name":"Casandra Downs",
    #       "react":[1,undefined],
    #       "tag":"Alchemy & Inscription Supplies",
    #       "type":7,
    #       stock:3,
    #       stack:1,
    #       cost:[315804]
    #     },
    #     {
    #       "classification":0,
    #       "id":50248,
    #       "location":[4922],
    #       "maxlevel":84,
    #       "minlevel":84,
    #       "name":"Una Kobuna",
    #       "react":[undefined,1],
    #       "tag":"Alchemy and Inscription Supplies",
    #       "type":7,
    #       stock:3,
    #       stack:1,
    #       cost:[315804]
    #     }
    #   ]
    # }
    0
  end
  
  # translate a floating point number into a hash of gold, silver and copper currencies
  def currency(price)
    currency = {:gold => 0, :silver => 0, :copper => 0}
    formatted_price   = sprintf("%.4f", price).split(".")
    currency[:gold]   = formatted_price[0].to_i
    currency[:silver] = formatted_price[1][0,2].to_i
    currency[:copper] = formatted_price[1][2,2].to_i
    currency
  end
  
  # translate a currency into a floating point number
  def currency_to_float(currency)
    (currency[:gold] + (currency[:silver].to_f / 100) + (currency[:copper].to_f / 10000)).to_f
  end
  
  # Return the markup for a given amount of gold, silver and copper currency
  def currency_tags(currency)
    coins = [:gold, :silver, :copper]
    tag_output = ""
    coins.each do |coin|
      if currency[coin] > 0 || tag_output.length > 0
        tag_output += tag :var, currency[coin], :class => coin.to_s
      end
    end
    tag_output
  end
  
  # Return a classname based on an integer-based item quality value
  def quality_class(quality)
    classname = case quality
      when 0 then "poor"
      when 1 then "common"
      when 2 then "uncommon"
      when 3 then "rare"
      when 4 then "epic"
      when 5 then "legendary"
      when 6 then "artifact"
      when 7 then "heirloom"
      else "poor"
    end
    classname
  end
end